---
title: "p8105_hw6_ys3924"
author: "YISU"
date: "2024-11-24"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(broom)
library(purrr)
```

### Problem 2

```{r, warning=FALSE}
homicide = read.csv("data/homicide-data.csv") |>
  janitor::clean_names() |>
  mutate(city_state = paste(city, state, sep = ", "),
         resolved = if_else(disposition == "Closed by arrest",TRUE, FALSE)) |>
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")),
         victim_race %in% c("White", "Black")) |>
  mutate(victim_age = as.numeric(victim_age))
baltimore = homicide |>
  filter(city_state == "Baltimore, MD")
baltimore_model = glm(resolved ~ victim_age + victim_sex + victim_race,
                      data = baltimore,
                      family = binomial)
broom::tidy(baltimore_model, conf.int = TRUE) |>
  mutate(OR = exp(estimate),
         OR_low = exp(conf.low),
         OR_high = exp(conf.high)) |>
  filter(term == "victim_sexMale") |>
  select(OR, OR_low, OR_high)
```

The estimate of the adjusted odds ratio for solving homicides comparing male victims to female victims keeping all other variables fixed is 0.426. The corresponding CI is [0.324, 0.558].


```{r, warning=FALSE}
OR_cities = homicide |>
  group_by(city_state) |>
  nest() |>
  mutate(
    model = map(data, ~ glm(resolved ~ victim_age + victim_sex + victim_race, 
                            data = ., 
                            family = binomial())),
    results = map(model, ~ broom::tidy(., conf.int = TRUE) |>
                    mutate(
                      OR = exp(estimate),
                      OR_low = exp(conf.low),
                      OR_high = exp(conf.high)))) |>
  unnest(results) |>
  filter(term == "victim_sexMale") |>
  select(city_state, OR, OR_low, OR_high)
OR_cities |>
  arrange(OR) |>
  ggplot(aes(x = fct_reorder(city_state, OR), y = OR)) +
  geom_point() +
  geom_errorbar(aes(ymin = OR_low, ymax = OR_high), width = 0.2) +
  coord_flip() +
  labs(
    title = "Odds Ratios for Solving Homicides by Gender",
    x = "City State",
    y = "Odds Ratio") +
  theme(axis.text.y = element_text(size = 7, hjust = 1))
```

According to above plot, cities like Albuquerque, NM, and Stockton, CA, have much higher odds ratios. On the other hand, cities like Baton Rouge, LA, and New York, NY, have lower odds ratios.

For most cities, the odds ratios look like they are below 1, which could mean that homicides with male victims are less likely to be solved than those with female victims. However, we can only be sure if the confidence intervals do not include 1.



